CREATE DATABASE CRUD_KAP;
USE CRUD_KAP;

CREATE TABLE PROFILE_ (
USERNAME VARCHAR(40) PRIMARY KEY,
PASSWORD_ VARCHAR(40),
EMAIL VARCHAR(40) UNIQUE ,
USER_CODE INT AUTO_INCREMENT UNIQUE,
NAME_ VARCHAR(40),
TELEPHONE VARCHAR(9),
CONSTRAINT CHK_TELEPHONE
        CHECK (TELEPHONE REGEXP '^[0-9]{9}$'),
SURNAME VARCHAR(40)
);

CREATE TABLE CARD (
CVV INT,
    CHECK (CVV BETWEEN 0 AND 999),
EXPIRATION_DATE DATE,
CARD_NUMBER VARCHAR(24) PRIMARY KEY,
CONSTRAINT CHK_CARD_NUMBER
        CHECK (CARD_NUMBER REGEXP '^[A-Z]{2}[0-9]{22}$')
);

CREATE TABLE USER_ (
USERNAME VARCHAR(40) PRIMARY KEY,
GENDER VARCHAR(40),
CARD_NUMBER VARCHAR(24) UNIQUE,
FOREIGN KEY (USERNAME) REFERENCES PROFILE_ (USERNAME) ON DELETE CASCADE,
FOREIGN KEY (CARD_NUMBER) REFERENCES CARD (CARD_NUMBER) ON DELETE CASCADE
);


CREATE TABLE ADMIN_ (
USERNAME VARCHAR(40) PRIMARY KEY,
CURRENT_ACCOUNT VARCHAR(40),
FOREIGN KEY (USERNAME) REFERENCES PROFILE_ (USERNAME) ON DELETE CASCADE
);

CREATE TABLE SHOE (
ID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
PRICE DOUBLE NOT NULL,
MODEL VARCHAR(30) NOT NULL,
SIZE DOUBLE NOT NULL,
EXCLUSIVE ENUM ('TRUE', 'FALSE') DEFAULT 'FALSE',
MANUFACTER_DATE DATE,
COLOR VARCHAR(20) NOT NULL,
ORIGIN VARCHAR(20) NOT NULL,
BRAND VARCHAR(20) NOT NULL,
RESERVED ENUM('TRUE', 'FALSE') DEFAULT 'FALSE',
STOCK INT
);

CREATE TABLE REVIEW(
ID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
ID_SHOE INT,
USERNAME VARCHAR(40),
DESCRIPTION VARCHAR(40),
RATING INT NOT NULL,
DATE_ DATE,
FOREIGN KEY (ID_SHOE) REFERENCES SHOE (ID) ON DELETE CASCADE,
FOREIGN KEY (USERNAME) REFERENCES USER_ (USERNAME) ON DELETE CASCADE);

CREATE TABLE ORDER_ (
ORDER_ID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
USERNAME VARCHAR(40),
SHOE_ID INT,
DATE_ DATE NOT NULL,
QUANTITY INT NOT NULL,
FOREIGN KEY (USERNAME) REFERENCES USER_ (USERNAME) ON DELETE CASCADE,
FOREIGN KEY (SHOE_ID) REFERENCES SHOE (ID) ON DELETE CASCADE);

INSERT INTO PROFILE_ (USERNAME, PASSWORD_, EMAIL, USER_CODE, NAME_, TELEPHONE, SURNAME)
VALUES
('jlopez', 'pass123', 'jlopez@example.com', 101, 'Juan', '987654321', 'Lopez'),
('mramirez', 'pass456', 'mramirez@example.com', 102, 'Maria', '912345678', 'Ramirez'),
('cperez', 'pass789', 'cperez@example.com', 103, 'Carlos', '934567890', 'Perez'),
('asanchez', 'qwerty', 'asanchez@example.com', 104, 'Ana', '900112233', 'Sanchez'),
('rluna', 'zxcvbn', 'rluna@example.com', 105, 'Rosa', '955667788', 'Luna');

INSERT INTO CARD (CVV, EXPIRATION_DATE, CARD_NUMBER) VALUES
(123, '2027-05-31', 'AA1234567890123456789012'),
(9,   '2026-12-31', 'BB0000000000000000000001'),
(600, '2030-01-15', 'CC9876543210987654321012');

INSERT INTO USER_ (USERNAME, GENDER, CARD_NUMBER)
VALUES
('jlopez', 'Masculino', 'AA1234567890123456789012'),
('mramirez', 'Femenino', 'BB0000000000000000000001'),
('cperez', 'Masculino', 'CC9876543210987654321012');

INSERT INTO ADMIN_ (USERNAME, CURRENT_ACCOUNT)
VALUES
('asanchez', 'CTA-001'),
('rluna', 'CTA-002');

INSERT INTO SHOE 
(PRICE, MODEL, SIZE, EXCLUSIVE, MANUFACTER_DATE, COLOR, ORIGIN, BRAND, RESERVED, STOCK)
VALUES
(79.99, 'Air Run', 42, 'FALSE', '2024-01-10', 'Negro', 'España', 'Nike', 'FALSE', 50),
(120.50, 'Street Max', 40, 'TRUE', '2023-11-05', 'Blanco', 'Italia', 'Adidas', 'FALSE', 30),
(95.00, 'Urban Flex', 41, 'FALSE', '2024-02-20', 'Azul', 'Portugal', 'Puma', 'TRUE', 10);

INSERT INTO REVIEW
(ID_SHOE, USERNAME, DESCRIPTION, RATING, DATE_)
VALUES
(1, 'jlopez', 'Muy cómodas', 5, '2024-03-01'),
(2, 'mramirez', 'Buen diseño', 4, '2024-03-05'),
(3, 'cperez', 'Algo ajustadas', 3, '2024-03-10');

INSERT INTO ORDER_
(USERNAME, SHOE_ID, DATE_, QUANTITY)
VALUES
('jlopez', 1, '2024-03-15', 2),
('cperez', 3, '2024-03-17', 1);